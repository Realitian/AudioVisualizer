(this.webpackJsonpreact=this.webpackJsonpreact||[]).push([[0],{15:function(e,t,a){},23:function(e,t,a){"use strict";a.r(t);var n,i,r,s,o,c,u=a(8),l=a(16),d=a.n(l),h=a(0),v=a(3),f=a(1),p=a(2),m=a(12),j=a(9),b=a.n(j),w=a(11),g=a(6),x=(a(15),a(5)),O=function(e){Object(f.a)(a,e);var t=Object(p.a)(a);function a(){var e;Object(h.a)(this,a);for(var u=arguments.length,l=new Array(u),d=0;d<u;d++)l[d]=arguments[d];return(e=t.call.apply(t,[this].concat(l))).state={lastVisual:null,scene:null},e.componentDidMount=function(){e.startVisual(s)},e.componentDidUpdate=Object(w.a)(b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("didupdate"),console.log("scene",e.props.shader),i.children[0].material.setValues({fragmentShader:e.props.shader,uniforms:n}),i.children[0].material.needsUpdate=!0;case 4:case"end":return t.stop()}}),t)}))),e.clearThree=function(){r.clear(),i.traverse((function(t){if(t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)e.cleanMaterial(t.material);else{var a,n=Object(m.a)(t.material);try{for(n.s();!(a=n.n()).done;){var i=a.value;e.cleanMaterial(i)}}catch(r){n.e(r)}finally{n.f()}}}))},e.cleanMaterial=function(e){e.dispose();for(var t=0,a=Object.keys(e);t<a.length;t++){var n=e[a[t]];n&&"object"===typeof n&&"minFilter"in n&&n.dispose()}},e.startVisual=Object(w.a)(b.a.mark((function t(){var a,u,l,d,h,v,f,p,m;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:m=function(e){setTimeout((function(){return requestAnimationFrame(m)}),.144),setTimeout((function(){return p(r,h)}),.144),s.getByteFrequencyData(o),e*=.001,n.iTime.value=e,n.iResolution.value.set(h.width,h.height,1),n.iChannel0.value.needsUpdate=!0,r.render(i,v)},p=function(e){var t=h.width!==window.innerWidth||h.height!==window.innerHeight;return t&&e.setSize(window.innerWidth,window.innerHeight),t},f=function(){i||(i=new g.f);var e=new g.e(2,2);n={iTime:{value:0},iResolution:{value:new g.h},iChannel0:{value:new g.a(o,s.fftSize/2,1,g.b)},iChannel1:{value:new g.a(o,s.fftSize/2,1,g.b)},iChannel2:{value:new g.a(o,s.fftSize/2,1,g.b)},iChannel3:{value:new g.a(o,s.fftSize/2,1,g.b)}},c=new g.g({fragmentShader:d,uniforms:n}),i.add(new g.c(e,c))},window.cancelAnimationFrame(m),a=e.props,u=a.source,l=a.audioCtx,d=e.props.shader,h=e.props.canvas,s||(console.log("new ana"),s=l.createAnalyser(),u.connect(s)),o||(o=new Uint8Array(s.frequencyBinCount)),r?r.clear():(console.log("new renderer"),r=new g.i({canvas:h})),v=new g.d(-1,1,1,-1,-1,1),h&&(l.resume(),f(),setTimeout((function(){return m()}),.144)),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;case 13:case"end":return t.stop()}}),t)}))),e}return Object(v.a)(a,[{key:"render",value:function(){return Object(x.jsx)("div",{})}}]),a}(u.Component),C=function(e){Object(f.a)(a,e);var t=Object(p.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).state={source:"",audioCtx:"",shader:"",canvas:"",visualNumber:11},e.getVisual=function(t){fetch("./".concat(t,".json"),{headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((function(e){return e.json()})).then((function(a){e.setState({visualNumber:t,shader:a.shader})}))},e.componentDidUpdate=function(){var t=document.getElementById("visualizerCanvas");e.state.canvas!==t&&e.setState({canvas:t})},e.changeVisual=function(t){var a=parseFloat(e.state.visualNumber)+parseFloat(t.target.value);a>0&&a<17&&e.getVisual(a)},e}return Object(v.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.state,a=t.source,n=t.audioCtx;n=new AudioContext,navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){a=n.createMediaStreamSource(t),e.setState({source:a,audioCtx:n})})),this.getVisual(11)}},{key:"render",value:function(){return Object(x.jsxs)(x.Fragment,{children:[this.state.audioCtx&&this.state.canvas&&this.state.shader?Object(x.jsx)("div",{children:Object(x.jsx)(O,{source:this.state.source,audioCtx:this.state.audioCtx,shader:this.state.shader,canvas:this.state.canvas})}):null,Object(x.jsx)("div",{id:"next",children:Object(x.jsx)("button",{onClick:this.changeVisual,value:1,children:"Next"})}),Object(x.jsx)("div",{id:"prev",children:Object(x.jsx)("button",{onClick:this.changeVisual,value:-1,children:"Previous"})}),Object(x.jsx)("canvas",{id:"visualizerCanvas"})]})}}]),a}(u.Component),y=document.getElementById("root");d.a.render(Object(x.jsx)(u.StrictMode,{children:Object(x.jsx)(C,{})}),y)}},[[23,1,2]]]);
//# sourceMappingURL=main.ceeac1b1.chunk.js.map